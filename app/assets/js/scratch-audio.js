!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("audio-context")):"function"==typeof define&&define.amd?define(["audio-context"],e):"object"==typeof exports?exports.AudioEngine=e(require("audio-context")):t.AudioEngine=e(t["audio-context"])}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){function i(){}n(12).mixin(i),i.prototype.write=function(t,e,n){this.emit("item",t,e,n)},i.prototype.end=function(){this.emit("end"),this.removeAllListeners()},i.prototype.pipe=function(t){var e=this;function n(){t.write.apply(t,Array.prototype.slice.call(arguments))}function i(){!t._isStdio&&t.end()}return e.emit("unpipe",t),t.emit("pipe",e),e.on("item",n),e.on("end",i),e.when("unpipe",(function(r){var o=r===t||void 0===r;return o&&(e.removeListener("item",n),e.removeListener("end",i),t.emit("unpipe")),o})),t},i.prototype.unpipe=function(t){return this.emit("unpipe",t),this},i.prototype.format=function(t){throw new Error(["Warning: .format() is deprecated in Minilog v2! Use .pipe() instead. For example:","var Minilog = require('minilog');","Minilog","  .pipe(Minilog.backends.console.formatClean)","  .pipe(Minilog.backends.console);"].join("\n"))},i.mixin=function(t){var e,n=i.prototype;for(e in n)n.hasOwnProperty(e)&&(t.prototype[e]=n[e])},t.exports=i},function(t,e,n){"use strict";var i=n(10);i.enable(),t.exports=i("scratch-audioengine")},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioEngine=e,this.audioPlayer=n,this.lastEffect=i,this.value=this.DEFAULT_VALUE,this.initialized=!1,this.inputNode=null,this.outputNode=null,this.target=null}return i(t,[{key:"getInputNode",value:function(){return this._isPatch?this.inputNode:this.target.getInputNode()}},{key:"initialize",value:function(){throw new Error(this.constructor.name+".initialize is not implemented.")}},{key:"_set",value:function(){throw new Error(this.constructor.name+"._set is not implemented.")}},{key:"set",value:function(t){this.initialized||this.initialize();var e=this._isPatch;e&&(this._lastPatch=this.audioEngine.currentTime),this._set(t),this._isPatch!==e&&null!==this.target&&this.connect(this.target)}},{key:"update",value:function(){}},{key:"clear",value:function(){this.set(this.DEFAULT_VALUE)}},{key:"connect",value:function(t){var e=this;if(null===t)throw new Error("target may not be null");if(function t(n){if(n)return n===e||t(n.target)}(t))throw new Error("Effect cannot connect to itself");this.target=t,null!==this.outputNode&&this.outputNode.disconnect(),(this._isPatch||this._lastPatch+this.audioEngine.DECAY_DURATION<this.audioEngine.currentTime)&&this.outputNode.connect(t.getInputNode()),null===this.lastEffect?null!==this.audioPlayer&&this.audioPlayer.connect(this):this.lastEffect.connect(this)}},{key:"dispose",value:function(){this.inputNode=null,this.outputNode=null,this.target=null,this.initialized=!1}},{key:"name",get:function(){throw new Error(this.constructor.name+".name is not implemented")}},{key:"DEFAULT_VALUE",get:function(){return 0}},{key:"_isPatch",get:function(){return this.initialized&&(this.value!==this.DEFAULT_VALUE||null===this.audioPlayer)}}]),t}();t.exports=r},function(t,e){var n={black:"#000",red:"#c23621",green:"#25bc26",yellow:"#bbbb00",blue:"#492ee1",magenta:"#d338d3",cyan:"#33bbc8",gray:"#808080",purple:"#708"};t.exports=function(t,e){return e?"color: #fff; background: "+n[t]+";":"color: "+n[t]+";"}},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"initialize",value:function(){this.inputNode=this.audioEngine.audioContext.createGain(),this.outputNode=this.inputNode,this.initialized=!0}},{key:"_set",value:function(t){this.value=t;var e=this.outputNode.gain,n=this.audioEngine,i=n.currentTime,r=n.DECAY_DURATION;e.linearRampToValueAtTime(t/100,i+r)}},{key:"dispose",value:function(){this.initialized&&(this.outputNode.disconnect(),this.inputNode=null,this.outputNode=null,this.target=null,this.initialized=!1)}},{key:"DEFAULT_VALUE",get:function(){return 100}},{key:"name",get:function(){return"volume"}}]),e}(n(2));t.exports=s},function(t,e,n){"use strict";var i=n(6);t.exports=i},function(t,e,n){"use strict";var i=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=n(7),u=n(9),a=n(1),c=n(20),l=n(21),f=n(23),h=n(24),d=n(26),p=n(27),y=n(28),v=n(4),g=n(29),m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new u;o(this,t),this.audioContext=e,s(this.audioContext),this.inputNode=this.audioContext.createGain(),this.inputNode.connect(this.audioContext.destination),this.audioBuffers={},this.loudness=null,this.effects=[p,y,v]}return r(t,[{key:"getInputNode",value:function(){return this.inputNode}},{key:"_decodeSound",value:function(t){var e,n,i=this,r=t.data.buffer.slice(0),o=c();return(e=this.audioContext,n=r,1===e.decodeAudioData.length?e.decodeAudioData(n):new Promise((function(t,i){e.decodeAudioData(n,(function(e){return t(e)}),(function(t){return i(t)}))}))).catch((function(){if(0===t.data.length)return i._emptySound();var e=t.data.buffer.slice(0);return new l(i.audioContext).decode(e).catch((function(){return i._emptySound()}))})).then((function(t){return[o,t]}),(function(t){a.warn("audio data could not be decoded",t)}))}},{key:"_emptySound",value:function(){return this.audioContext.createBuffer(1,1,this.audioContext.sampleRate)}},{key:"decodeSound",value:function(t){var e=this;return this._decodeSound(t).then((function(t){var n=i(t,2),r=n[0],o=n[1];return e.audioBuffers[r]=o,r}))}},{key:"decodeSoundPlayer",value:function(t){var e=this;return this._decodeSound(t).then((function(t){var n=i(t,2),r=n[0],o=n[1];return new h(e,{id:r,buffer:o})}))}},{key:"getLoudness",value:function(){return this.loudness||(this.loudness=new f(this.audioContext)),this.loudness.getLoudness()}},{key:"createEffectChain",value:function(){var t=new d(this,this.effects);return t.connect(this),t}},{key:"createBank",value:function(){return new g(this,this.createEffectChain())}},{key:"currentTime",get:function(){return this.audioContext.currentTime}},{key:"EFFECT_NAMES",get:function(){return{pitch:"pitch",pan:"pan"}}},{key:"DECAY_DURATION",get:function(){return.025}},{key:"DECAY_WAIT",get:function(){return.05}}]),t}();t.exports=m},function(t,e,n){"use strict";var i=n(8);t.exports=function(t){if("undefined"!=typeof document)return i(t)}},function(t,e,n){var i,r,o;
/**
 *  StartAudioContext.js
 *  @author Yotam Mann
 *  @license http://opensource.org/licenses/MIT MIT License
 *  @copyright 2016 Yotam Mann
 */r=[],void 0===(o="function"==typeof(i=function(){var t=function(t,e){this._dragged=!1,this._element=t,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,e),t.addEventListener("touchstart",this._bindedEnd),t.addEventListener("touchmove",this._bindedMove),t.addEventListener("touchend",this._bindedEnd),t.addEventListener("mouseup",this._bindedEnd)};function e(t){return"running"===t.state}return t.prototype._moved=function(t){this._dragged=!0},t.prototype._ended=function(t){this._dragged||function(t){var e=t.createBuffer(1,1,t.sampleRate),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0),t.resume&&t.resume()}(t),this._dragged=!1},t.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},function(n,i,r){var o=new Promise((function(t){!function(t,n){e(t)?n():function i(){e(t)?n():(requestAnimationFrame(i),t.resume&&t.resume())}()}(n,t)})),s=[];return i||(i=document.body),function e(n,i,r){if(Array.isArray(n)||NodeList&&n instanceof NodeList)for(var o=0;o<n.length;o++)e(n[o],i,r);else if("string"==typeof n)e(document.querySelectorAll(n),i,r);else if(n.jquery&&"function"==typeof n.toArray)e(n.toArray(),i,r);else if(Element&&n instanceof Element){var s=new t(n,r);i.push(s)}}(i,s,n),o.then((function(){for(var t=0;t<s.length;t++)s[t].dispose();s=null,r&&r()})),o}})?i.apply(e,r):i)||(t.exports=o)},function(e,n){e.exports=t},function(t,e,n){var i=n(11),r=i.enable,o=i.disable,s="undefined"!=typeof navigator&&/chrome/i.test(navigator.userAgent),u=n(14);if(i.defaultBackend=s?u.minilog:u,"undefined"!=typeof window){try{i.enable(JSON.parse(window.localStorage.minilogSettings))}catch(t){}if(window.location&&window.location.search){var a=RegExp("[?&]minilog=([^&]*)").exec(window.location.search);a&&i.enable(decodeURIComponent(a[1]))}}i.enable=function(){r.call(i,!0);try{window.localStorage.minilogSettings=JSON.stringify(!0)}catch(t){}return this},i.disable=function(){o.call(i);try{delete window.localStorage.minilogSettings}catch(t){}return this},(t.exports=i).backends={array:n(17),browser:i.defaultBackend,localStorage:n(18),jQuery:n(19)}},function(t,e,n){var i=n(0),r=n(13),o=new i,s=Array.prototype.slice;(e=t.exports=function(t){var n=function(){return o.write(t,void 0,s.call(arguments)),n};return n.debug=function(){return o.write(t,"debug",s.call(arguments)),n},n.info=function(){return o.write(t,"info",s.call(arguments)),n},n.warn=function(){return o.write(t,"warn",s.call(arguments)),n},n.error=function(){return o.write(t,"error",s.call(arguments)),n},n.log=n.debug,n.suggest=e.suggest,n.format=o.format,n}).defaultBackend=e.defaultFormatter=null,e.pipe=function(t){return o.pipe(t)},e.end=e.unpipe=e.disable=function(t){return o.unpipe(t)},e.Transform=i,e.Filter=r,e.suggest=new r,e.enable=function(){return e.defaultFormatter?o.pipe(e.suggest).pipe(e.defaultFormatter).pipe(e.defaultBackend):o.pipe(e.suggest).pipe(e.defaultBackend)}},function(t,e){function n(){this._events={}}n.prototype={on:function(t,e){this._events||(this._events={});var n=this._events;return(n[t]||(n[t]=[])).push(e),this},removeListener:function(t,e){var n,i=this._events[t]||[];for(n=i.length-1;n>=0&&i[n];n--)i[n]!==e&&i[n].cb!==e||i.splice(n,1)},removeAllListeners:function(t){t?this._events[t]&&(this._events[t]=[]):this._events={}},listeners:function(t){return this._events&&this._events[t]||[]},emit:function(t){this._events||(this._events={});var e,n=Array.prototype.slice.call(arguments,1),i=this._events[t]||[];for(e=i.length-1;e>=0&&i[e];e--)i[e].apply(this,n);return this},when:function(t,e){return this.once(t,e,!0)},once:function(t,e,n){if(!e)return this;function i(){n||this.removeListener(t,i),e.apply(this,arguments)&&n&&this.removeListener(t,i)}return i.cb=e,this.on(t,i),this}},n.mixin=function(t){var e,i=n.prototype;for(e in i)i.hasOwnProperty(e)&&(t.prototype[e]=i[e])},t.exports=n},function(t,e,n){var i=n(0),r={debug:1,info:2,warn:3,error:4};function o(){this.enabled=!0,this.defaultResult=!0,this.clear()}function s(t,e){return t.n.test?t.n.test(e):t.n==e}i.mixin(o),o.prototype.allow=function(t,e){return this._white.push({n:t,l:r[e]}),this},o.prototype.deny=function(t,e){return this._black.push({n:t,l:r[e]}),this},o.prototype.clear=function(){return this._white=[],this._black=[],this},o.prototype.test=function(t,e){var n,i=Math.max(this._white.length,this._black.length);for(n=0;n<i;n++){if(this._white[n]&&s(this._white[n],t)&&r[e]>=this._white[n].l)return!0;if(this._black[n]&&s(this._black[n],t)&&r[e]<=this._black[n].l)return!1}return this.defaultResult},o.prototype.write=function(t,e,n){if(!this.enabled||this.test(t,e))return this.emit("item",t,e,n)},t.exports=o},function(t,e,n){var i=n(0),r=/\n+$/,o=new i;o.write=function(t,e,n){var i=n.length-1;if("undefined"!=typeof console&&console.log){if(console.log.apply)return console.log.apply(console,[t,e].concat(n));if(JSON&&JSON.stringify){n[i]&&"string"==typeof n[i]&&(n[i]=n[i].replace(r,""));try{for(i=0;i<n.length;i++)n[i]=JSON.stringify(n[i])}catch(t){}console.log(n.join(" "))}}},o.formatters=["color","minilog"],o.color=n(15),o.minilog=n(16),t.exports=o},function(t,e,n){var i=n(0),r=n(3),o={debug:["cyan"],info:["purple"],warn:["yellow",!0],error:["red",!0]},s=new i;s.write=function(t,e,n){console.log;console[e]&&console[e].apply&&console[e].apply(console,["%c"+t+" %c"+e,r("gray"),r.apply(r,o[e])].concat(n))},s.pipe=function(){},t.exports=s},function(t,e,n){var i=n(0),r=n(3),o={debug:["gray"],info:["purple"],warn:["yellow",!0],error:["red",!0]},s=new i;s.write=function(t,e,n){var i=console.log;"debug"!=e&&console[e]&&(i=console[e]);var s=0;if("info"!=e){for(;s<n.length&&"string"==typeof n[s];s++);i.apply(console,["%c"+t+" "+n.slice(0,s).join(" "),r.apply(r,o[e])].concat(n.slice(s)))}else i.apply(console,["%c"+t,r.apply(r,o[e])].concat(n))},s.pipe=function(){},t.exports=s},function(t,e,n){var i=n(0),r=[],o=new i;o.write=function(t,e,n){r.push([t,e,n])},o.get=function(){return r},o.empty=function(){r=[]},t.exports=o},function(t,e,n){var i=n(0),r=!1,o=new i;o.write=function(t,e,n){if("undefined"!=typeof window&&"undefined"!=typeof JSON&&JSON.stringify&&JSON.parse)try{r||(r=window.localStorage.minilog?JSON.parse(window.localStorage.minilog):[]),r.push([(new Date).toString(),t,e,n]),window.localStorage.minilog=JSON.stringify(r)}catch(t){}},t.exports=o},function(t,e,n){var i=n(0),r=(new Date).valueOf().toString(36);function o(t){this.url=t.url||"",this.cache=[],this.timer=null,this.interval=t.interval||3e4,this.enabled=!0,this.jQuery=window.jQuery,this.extras={}}i.mixin(o),o.prototype.write=function(t,e,n){this.timer||this.init(),this.cache.push([t,e].concat(n))},o.prototype.init=function(){if(this.enabled&&this.jQuery){var t=this;this.timer=setTimeout((function(){var e,n,i=[],o=t.url;if(0==t.cache.length)return t.init();for(e=0;e<t.cache.length;e++)try{JSON.stringify(t.cache[e]),i.push(t.cache[e])}catch(t){}t.jQuery.isEmptyObject(t.extras)?(n=JSON.stringify({logs:i}),o=t.url+"?client_id="+r):n=JSON.stringify(t.jQuery.extend({logs:i},t.extras)),t.jQuery.ajax(o,{type:"POST",cache:!1,processData:!1,data:n,contentType:"application/json",timeout:1e4}).success((function(e,n,i){e.interval&&(t.interval=Math.max(1e3,e.interval))})).error((function(){t.interval=3e4})).always((function(){t.init()})),t.cache=[]}),this.interval)}},o.prototype.end=function(){},o.jQueryWait=function(t){if("undefined"!=typeof window&&(window.jQuery||window.$))return t(window.jQuery||window.$);"undefined"!=typeof window&&setTimeout((function(){o.jQueryWait(t)}),200)},t.exports=o},function(t,e,n){"use strict";var i="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t.exports=function(){for(var t=i.length,e=[],n=0;n<20;n++)e[n]=i.charAt(Math.random()*t);return e.join("")}},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=n(22),o=n(1),s=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767],u=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],a=null,c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioContext=e}return i(t,[{key:"decode",value:function(t){var e=this;return new Promise((function(n,i){var s=new r(t);"RIFF"!==s.readUint8String(4)&&(o.warn("incorrect adpcm wav header"),i());var u=s.readInt32();u+8!==t.byteLength&&o.warn("adpcm wav length in header: "+u+" is incorrect"),"WAVE"!==s.readUint8String(4)&&(o.warn("incorrect adpcm wav header"),i());var a=e.extractChunk("fmt ",s);e.encoding=a.readUint16(),e.channels=a.readUint16(),e.samplesPerSecond=a.readUint32(),e.bytesPerSecond=a.readUint32(),e.blockAlignment=a.readUint16(),e.bitsPerSample=a.readUint16(),a.position+=2,e.samplesPerBlock=a.readUint16(),e.adpcmBlockSize=(e.samplesPerBlock-1)/2+4;var c=e.extractChunk("data",s),l=e.numberOfSamples(c,e.adpcmBlockSize),f=e.audioContext.createBuffer(1,l,e.samplesPerSecond);e.imaDecompress(c,e.adpcmBlockSize,f.getChannelData(0)),n(f)}))}},{key:"extractChunk",value:function(t,e){for(e.position=12;e.position<e.getLength()-8;){var n=e.readUint8String(4),i=e.readInt32();if(n===t)return e.extract(i);e.position+=i}}},{key:"numberOfSamples",value:function(t,e){if(!t)return 0;t.position=0;var n=t.getBytesAvailable();return(n/e|0)*(2*(e-4))+1+2*Math.max(n%e-4,0)+Math.min(n%e,1)}},{key:"imaDecompress",value:function(t,e,n){var i=void 0,r=void 0,o=void 0,c=0,l=-1;if(t){t.position=0;for(var f=n.length,h=2*(e-4),d=function(){if(null===a){var t=s.length,e=u.length;a=new Array(t*e).fill(0);for(var n=0,i=0;i<t;i++)for(var r=0;r<e;r++){var o=s[i],c=0;4&r&&(c+=o),2&r&&(c+=o>>1),1&r&&(c+=o>>2),c+=o>>3,a[n++]=8&r?-c:c}}return a}(),p=0;p<f;){i=t.readInt16(),c=t.readUint8(),t.position++,c>88&&(c=88),n[p++]=i/32768;for(var y=Math.min(h,f-p),v=p;p-v<y;)o=d[16*c+(r=15&(l=t.readUint8()))],(c+=u[r])>88?c=88:c<0&&(c=0),(i+=o)>32767?i=32767:i<-32768&&(i=-32768),n[p++]=i/32768,o=d[16*c+(r=l>>4&15)],(c+=u[r])>88?c=88:c<0&&(c=0),(i+=o)>32767?i=32767:i<-32768&&(i=-32768),n[p++]=i/32768}}}}],[{key:"STEP_TABLE",get:function(){return s}},{key:"INDEX_TABLE",get:function(){return u}}]),t}();t.exports=c},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=o._uint8View,u=void 0===s?new Uint8Array(e):s;r(this,t),this.arrayBuffer=e,this.start=n,this.end=i,this._uint8View=u,this._position=n}return i(t,[{key:"extract",value:function(e){return new t(this.arrayBuffer,this._position,this._position+e,this)}},{key:"getLength",value:function(){return this.end-this.start}},{key:"getBytesAvailable",value:function(){return this.end-this._position}},{key:"readUint8",value:function(){var t=this._uint8View[this._position];return this._position+=1,t}},{key:"readUint8String",value:function(t){for(var e=this._uint8View,n="",i=this._position+t,r=this._position;r<i;r++)n+=String.fromCharCode(e[r]);return this._position+=t,n}},{key:"readInt16",value:function(){var t=new Int16Array(this.arrayBuffer,this._position,1)[0];return this._position+=2,t}},{key:"readUint16",value:function(){var t=new Uint16Array(this.arrayBuffer,this._position,1)[0];return this._position+=2,t}},{key:"readInt32",value:function(){var t=void 0;return t=this._position%4==0?new Int32Array(this.arrayBuffer,this._position,1)[0]:new Int32Array(this.arrayBuffer.slice(this._position,this._position+4))[0],this._position+=4,t}},{key:"readUint32",value:function(){var t=new Uint32Array(this.arrayBuffer,this._position,1)[0];return this._position+=4,t}},{key:"position",get:function(){return this._position-this.start},set:function(t){return this._position=t+this.start,t}}]),t}();t.exports=o},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=n(1),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioContext=e,this.connectingToMic=!1,this.mic=null}return i(t,[{key:"getLoudness",value:function(){var t=this;if(this.mic||this.connectingToMic||(this.connectingToMic=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){t.audioStream=e,t.mic=t.audioContext.createMediaStreamSource(e),t.analyser=t.audioContext.createAnalyser(),t.mic.connect(t.analyser),t.micDataArray=new Float32Array(t.analyser.fftSize)})).catch((function(t){r.warn(t)}))),this.mic&&this.audioStream.active){this.analyser.getFloatTimeDomainData(this.micDataArray);for(var e=0,n=0;n<this.micDataArray.length;n++)e+=Math.pow(this.micDataArray[n],2);var i=Math.sqrt(e/this.micDataArray.length);return this._lastValue&&(i=Math.max(i,.6*this._lastValue)),this._lastValue=i,i*=1.63,i=Math.sqrt(i),i=Math.round(100*i),i=Math.min(i,100)}return-1}}]),t}();t.exports=o},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=n(25).EventEmitter,o=n(4),s=function(t){function e(t,n){var i=n.id,r=n.buffer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.id=i,o.audioEngine=t,o.buffer=r,o.outputNode=null,o.volumeEffect=null,o.target=null,o.initialized=!1,o.isPlaying=!1,o.startingUntil=0,o.playbackRate=1,o.handleEvent=o.handleEvent.bind(o),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"handleEvent",value:function(t){"ended"===t.type&&this.onEnded()}},{key:"onEnded",value:function(){this.emit("stop"),this.isPlaying=!1}},{key:"_createSource",value:function(){null!==this.outputNode&&(this.outputNode.removeEventListener("ended",this.handleEvent),this.outputNode.disconnect()),this.outputNode=this.audioEngine.audioContext.createBufferSource(),this.outputNode.playbackRate.value=this.playbackRate,this.outputNode.buffer=this.buffer,this.outputNode.addEventListener("ended",this.handleEvent),null!==this.target&&this.connect(this.target)}},{key:"initialize",value:function(){this.initialized=!0,this._createSource()}},{key:"connect",value:function(t){return t===this.volumeEffect?(this.outputNode.disconnect(),void this.outputNode.connect(this.volumeEffect.getInputNode())):(this.target=t,this.initialized?(null===this.volumeEffect?(this.outputNode.disconnect(),this.outputNode.connect(t.getInputNode())):this.volumeEffect.connect(t),this):void 0)}},{key:"dispose",value:function(){this.initialized&&(this.stopImmediately(),null!==this.volumeEffect&&(this.volumeEffect.dispose(),this.volumeEffect=null),this.outputNode.disconnect(),this.outputNode=null,this.target=null,this.initialized=!1)}},{key:"take",value:function(){this.outputNode&&this.outputNode.removeEventListener("ended",this.handleEvent);var t=new e(this.audioEngine,this);return t.playbackRate=this.playbackRate,this.isPlaying&&(t.startingUntil=this.startingUntil,t.isPlaying=this.isPlaying,t.initialized=this.initialized,t.outputNode=this.outputNode,t.outputNode.addEventListener("ended",t.handleEvent),t.volumeEffect=this.volumeEffect,t.volumeEffect&&(t.volumeEffect.audioPlayer=t),null!==this.target&&t.connect(this.target),this.emit("stop"),t.emit("play")),this.outputNode=null,this.volumeEffect=null,this.initialized=!1,this.startingUntil=0,this.isPlaying=!1,t}},{key:"play",value:function(){if(this.isStarting)return this.emit("stop"),void this.emit("play");this.isPlaying&&this.stop(),this.initialized?this._createSource():this.initialize(),this.outputNode.start(),this.isPlaying=!0;var t=this.audioEngine,e=t.currentTime,n=t.DECAY_DURATION;this.startingUntil=e+n,this.emit("play")}},{key:"stop",value:function(){if(this.isPlaying){var t=this.take();t.volumeEffect=new o(t.audioEngine,t,null),t.volumeEffect.connect(t.target),t.finished().then((function(){return t.dispose()})),t.volumeEffect.set(0);var e=this.audioEngine,n=e.currentTime,i=e.DECAY_DURATION;t.outputNode.stop(n+i)}}},{key:"stopImmediately",value:function(){this.isPlaying&&(this.outputNode.stop(),this.isPlaying=!1,this.startingUntil=0,this.emit("stop"))}},{key:"finished",value:function(){var t=this;return new Promise((function(e){t.once("stop",e)}))}},{key:"setPlaybackRate",value:function(t){this.playbackRate=t,this.initialized&&(this.outputNode.playbackRate.value=t)}},{key:"isStarting",get:function(){return this.isPlaying&&this.startingUntil>this.audioEngine.currentTime}}]),e}(r);t.exports=s},function(t,e,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function u(){u.init.call(this)}t.exports=u,t.exports.once=function(t,e){return new Promise((function(n,i){function r(){void 0!==o&&t.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==e&&(o=function(n){t.removeListener(e,r),i(n)},t.once("error",o)),t.once(e,r)}))},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var a=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?u.defaultMaxListeners:t._maxListeners}function f(t,e,n,i){var r,o,s,u;if(c(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]),void 0===s)s=o[e]=n,++t._eventsCount;else if("function"==typeof s?s=o[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=l(t))>0&&s.length>r&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,u=a,console&&console.warn&&console.warn(u)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=h.bind(i);return r.listener=n,i.wrapFn=r,r}function p(t,e,n){var i=t._events;if(void 0===i)return[];var r=i[e];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):v(r,r.length)}function y(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},u.prototype.getMaxListeners=function(){return l(this)},u.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var a=r[t];if(void 0===a)return!1;if("function"==typeof a)o(a,this,e);else{var c=a.length,l=v(a,c);for(n=0;n<c;++n)o(l[n],this,e)}return!0},u.prototype.addListener=function(t,e){return f(this,t,e,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(t,e){return f(this,t,e,!0)},u.prototype.once=function(t,e){return c(e),this.on(t,d(this,t,e)),this},u.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,d(this,t,e)),this},u.prototype.removeListener=function(t,e){var n,i,r,o,s;if(c(e),void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,r),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,s||e)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},u.prototype.listeners=function(t){return p(this,t,!0)},u.prototype.rawListeners=function(t){return p(this,t,!1)},u.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},u.prototype.listenerCount=y,u.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioEngine=e,this.inputNode=this.audioEngine.audioContext.createGain(),this.effects=n;var r=null;this._effects=n.reverse().map((function(t){var n=new t(e,i,r);return i[n.name]=n,r=n,n})).reverse(),this.firstEffect=this._effects[0],this.lastEffect=this._effects[this._effects.length-1],this._soundPlayers=new Set}return i(t,[{key:"clone",value:function(){var e=new t(this.audioEngine,this.effects);return this.target&&e.connect(this.target),e}},{key:"addSoundPlayer",value:function(t){this._soundPlayers.has(t)||(this._soundPlayers.add(t),this.update())}},{key:"removeSoundPlayer",value:function(t){this._soundPlayers.remove(t)}},{key:"getInputNode",value:function(){return this.inputNode}},{key:"connect",value:function(t){var e=this.firstEffect,n=this.lastEffect;if(t===n)return this.inputNode.disconnect(),void this.inputNode.connect(n.getInputNode());t!==e&&(this.target=t,e.connect(t))}},{key:"getSoundPlayers",value:function(){return[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this._soundPlayers))}},{key:"setEffectsFromTarget",value:function(t){this._effects.forEach((function(e){"soundEffects"in t&&e.name in t.soundEffects?e.set(t.soundEffects[e.name]):e.name in t&&e.set(t[e.name])}))}},{key:"set",value:function(t,e){t in this&&this[t].set(e)}},{key:"update",value:function(){this._effects.forEach((function(t){return t.update()}))}},{key:"clear",value:function(){this._effects.forEach((function(t){return t.clear()}))}},{key:"dispose",value:function(){this._soundPlayers=null,this._effects.forEach((function(t){return t.dispose()})),this._effects=null}}]),t}();t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(t){function e(t,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));return r.leftGain=null,r.rightGain=null,r.channelMerger=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"initialize",value:function(){var t=this.audioEngine.audioContext;this.inputNode=t.createGain(),this.leftGain=t.createGain(),this.rightGain=t.createGain(),this.channelMerger=t.createChannelMerger(2),this.outputNode=this.channelMerger,this.inputNode.connect(this.leftGain),this.inputNode.connect(this.rightGain),this.leftGain.connect(this.channelMerger,0,0),this.rightGain.connect(this.channelMerger,0,1),this.initialized=!0}},{key:"_set",value:function(t){this.value=t;var e=(t+100)/200,n=Math.cos(e*Math.PI/2),i=Math.sin(e*Math.PI/2),r=this.audioEngine,o=r.currentTime,s=r.DECAY_WAIT,u=r.DECAY_DURATION;this.leftGain.gain.setTargetAtTime(n,o+s,u),this.rightGain.gain.setTargetAtTime(i,o+s,u)}},{key:"dispose",value:function(){this.initialized&&(this.inputNode.disconnect(),this.leftGain.disconnect(),this.rightGain.disconnect(),this.channelMerger.disconnect(),this.inputNode=null,this.leftGain=null,this.rightGain=null,this.channelMerger=null,this.outputNode=null,this.target=null,this.initialized=!1)}},{key:"name",get:function(){return"pan"}}]),e}(n(2));t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(t){function e(t,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));return r.ratio=1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"getInputNode",value:function(){return this.target.getInputNode()}},{key:"initialize",value:function(){this.initialized=!0}},{key:"_set",value:function(t){this.value=t,this.ratio=this.getRatio(this.value),this.updatePlayers(this.audioPlayer.getSoundPlayers())}},{key:"update",value:function(){this.updatePlayers(this.audioPlayer.getSoundPlayers())}},{key:"getRatio",value:function(t){var e=t/10;return Math.pow(2,e/12)}},{key:"updatePlayer",value:function(t){t.setPlaybackRate(this.ratio)}},{key:"updatePlayers",value:function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&this.updatePlayer(t[e])}},{key:"name",get:function(){return"pitch"}},{key:"_isPatch",get:function(){return!1}}]),e}(n(2));t.exports=r},function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=n(1),o=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioEngine=e,this.soundPlayers={},this.playerTargets=new Map,this.soundEffects=new Map,this.effectChainPrime=n}return i(t,[{key:"addSoundPlayer",value:function(t){this.soundPlayers[t.id]=t}},{key:"getSoundPlayer",value:function(t){return this.soundPlayers[t]||r.error("SoundBank.getSoundPlayer("+t+"): called missing sound in bank"),this.soundPlayers[t]}},{key:"getSoundEffects",value:function(t){return this.soundEffects.has(t)||this.soundEffects.set(t,this.effectChainPrime.clone()),this.soundEffects.get(t)}},{key:"playSound",value:function(t,e){var n=this.getSoundEffects(e),i=this.getSoundPlayer(e);return this.playerTargets.get(e)!==t&&i.stop(),this.playerTargets.set(e,t),n.addSoundPlayer(i),n.setEffectsFromTarget(t),i.connect(n),i.play(),i.finished()}},{key:"setEffects",value:function(t){var e=this;this.playerTargets.forEach((function(n,i){n===t&&e.getSoundEffects(i).setEffectsFromTarget(t)}))}},{key:"stop",value:function(t,e){this.playerTargets.get(e)===t&&this.soundPlayers[e].stop()}},{key:"stopAllSounds",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"*";this.playerTargets.forEach((function(n,i){"*"!==e&&n!==e||t.getSoundPlayer(i).stop()}))}},{key:"dispose",value:function(){for(var t in this.playerTargets.clear(),this.soundEffects.forEach((function(t){return t.dispose()})),this.soundEffects.clear(),this.soundPlayers)this.soundPlayers.hasOwnProperty(t)&&this.soundPlayers[t].dispose();this.soundPlayers={}}}]),t}();t.exports=o}])}));
//# sourceMappingURL=dist.js.map